[gcode_macro PROBE_PRE]
description: Perform pre-probe actions
gcode:
    {% set CFG = printer["gcode_macro _CONFIG"] %}
    {% set GO_BACK = params.BACK|default(0) %}

    _MACRO_ENTRY NAME=PROBE_PRE

    {% if CFG.probe|string|upper == "TAP" %}
        _PROBE_PRE_TAP
    {% elif CFG.probe|string|upper == "KLICKY" %}
        _PROBE_PRE_KLICKY
    {% endif %}

    _MACRO_EXIT NAME=PROBE_PRE MOVE={GO_BACK}

[gcode_macro PROBE_POS]
description: Perform post-probe actions
gcode:
    {% set CFG = printer["gcode_macro _CONFIG"] %}
    {% set GO_BACK = params.BACK|default(0) %}

    _MACRO_ENTRY NAME=PROBE_POS
    
    {% if CFG.probe|string|upper == "KLICKY" %}
        _PROBE_POS_KLICKY
    {% endif %}

    _MACRO_EXIT NAME=PROBE_POS MOVE={GO_BACK}

[gcode_macro PROBE_LOCK]
description: Locks detachable probes
gcode:
    {% set CFG = printer["gcode_macro _CONFIG"] %}

    _MACRO_ENTRY NAME=PROBE_LOCK

    {% if CFG.probe|string|upper == "KLICKY" %}
        _PROBE_KLICKY_LOCK LOCK=1
    {% endif %}

    _MACRO_EXIT NAME=PROBE_LOCK

[gcode_macro PROBE_UNLOCK]
description: Unlocks detachable probes
gcode:
    {% set CFG = printer["gcode_macro _CONFIG"] %}

    _MACRO_ENTRY NAME=PROBE_UNLOCK

    {% if CFG.probe|string|upper == "KLICKY" %}
        _PROBE_KLICKY_LOCK LOCK=0
    {% endif %}

    _MACRO_EXIT NAME=PROBE_UNLOCK

[gcode_macro PROBE_CHECK]
variable_probe_state: 0
gcode:
    {% set CFG = printer["gcode_macro _CONFIG"] %}
    QUERY_PROBE
    {% if CFG.probe|string|upper == "KLICKY" %}
        _KLICKY_SET_PROBE_STATE {rawparams}
    {% endif %}