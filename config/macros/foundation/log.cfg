[gcode_macro _LOG]
description: Log messages
gcode:
    {% set NAME    = params.NAME|string %}
    {% set LVL     = params.LVL|string %}
    {% set MESSAGE = params.MSG|default("")|string %}
    {% set DISPLAY = params.DISPLAY %}
    {% set CONSOLE = params.CONSOLE %}
    {% set NOTIFY  = params.NOTIFY %}

    {% if 'LVL' in params %}
        {% if LVL|lower == "trace" %}
            {% set LVL = 4 %}
            {% set prefix = "[" + NAME + "] " + "trace: " %}
        {% elif LVL|lower == "debug" %}
            {% set LVL = 3 %}
            {% set LVL = "[" + NAME + "] " + "debug: " %}
        {% elif LVL|lower == "info" %}
            {% set LVL = 2 %}
            {% set prefix = "[" + NAME + "] " + "info: " %}
        {% elif LVL|lower == "warn" %}
            {% set LVL = 1 %}
            {% set prefix = "[" + NAME + "] " + "warn: " %}
        {% elif LVL|lower == "error" %}
            {% set LVL = 0 %}
            {% set prefix = "[" + NAME + "] " + "error: " %}
        {% else %}
            {% set LVL = -1 %}
            {% set prefix = NAME + ": " %}
        {% endif %}
    {% else %}
        {% set LVL = -1 %}
        {% set prefix = NAME + ": " %}
    {% endif %}

    {% if 'DISPLAY' in params %}
        {% set DISPLAY = True %}
    {% else %}
        {% set DISPLAY = False %}
    {% endif %}

    {% if 'CONSOLE' in params %}
        {% set CONSOLE = False %}
    {% else %}
        {% set CONSOLE = True %}
    {% endif %}

    {% if 'NOTIFY' in params %}
        {% set NOTIFY = True %}
    {% else %}
        {% set NOTIFY = False %}
    {% endif %}

    {% if False %}
        RESPOND MSG="Name/LVL is: '{NAME}'/'{LVL}'"
        RESPOND MSG="Prefix is: '{prefix}'"
        RESPOND MSG="MSG is: '{MESSAGE}'"
        RESPOND MSG="CONSOLE/DISPLAY is: '{CONSOLE}'/'{DISPLAY}'"
    {% endif %}
        
    {% if DISPLAY == True %}
        SET_DISPLAY_TEXT MSG="{NAME}: {MESSAGE}"
        UPDATE_DELAYED_GCODE ID=clear_display DURATION=30
    {% endif %}

    {% if CONSOLE == True %}
        {% if LVL == 0 %}
            RESPOND TYPE=error PREFIX="{prefix}" MSG="{MESSAGE}"
        {% else %}
            {% if NOTIFY == True %}
                {% set NOTIFY = "MR_NOTIFY:" + prefix + "|" + MESSAGE %}
                { action_respond_info(NOTIFY) }
            {% else %}
                {% if LVL == -1 %}
                  RESPOND PREFIX="{NAME}: " MSG="{MESSAGE}"
                {% else %}
                    RESPOND TYPE=echo PREFIX="{prefix}" MSG="{MESSAGE}"
                {% endif %}
            {% endif %}
        {% endif %}
    {% endif %}

    