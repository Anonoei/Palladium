[gcode_macro TURN_OFF_HEATERS]
description: Turns off heaters
rename_existing: _TURN_OFF_HEATERS
gcode:
    _TURN_OFF_HEATERS
    _SET_STATUS STATUS=active

[gcode_macro SET_HEATER_TEMPERATURE]
description: Set heater temperature override
rename_existing: _SET_HEATER_TEMPERATURE
gcode:
    {% set HEATER = params.HEATER %}
    {% set TARGET = params.TARGET|default(0)|int %}
    SET_HEATER HEATER={HEATER} TEMP={TARGET}

[gcode_macro SET_HEATER]
description: Set heater temperature
gcode:
    {% set HEATER = params.HEATER %}
    {% set WAIT = params.WAIT|default(0)|int %}
    {% set TEMP = params.TEMP|default(0)|int %}
    {% set VARIANCE = params.VARIANCE|default(1)|int %}

    {% if TEMP == 0 %}
        {% set WAIT = 0 %}
    {% endif %}

    _SET_STATUS STATUS=heating

    _LOG NAME="aliases.heater.SET_HEATER" LVL=TRACE MSG="Running SET_HEATER_TEMPERATURE HEATER={HEATER} TARGET={TEMP}"
    _SET_HEATER_TEMPERATURE HEATER={HEATER} TARGET={TEMP}
    {% if WAIT == 1 %}
        _LOG NAME="aliases.heater.SET_HEATER" LVL=TRACE MSG="Running TEMPERATURE_WAIT SENSOR={HEATER} MINIMUM={TEMP-VARIANCE} MAXIMUM={TEMP+VARIANCE}"
        TEMPERATURE_WAIT SENSOR={HEATER} MINIMUM={TEMP-VARIANCE} MAXIMUM={TEMP+VARIANCE}
        _SET_STATUS STATUS=active
    {% endif %}
    
[gcode_macro _SET_HOTEND]
description: Set hotend temperature
gcode:
    {% set TEMP = params.TEMP|default(0)|int %}
    {% set TOOL = params.TOOL|default(-1)|int %}
    {% set WAIT = params.WAIT|default(0)|int %}

    {% if TOOL == -1 or TOOL == 0 %}
        SET_HEATER HEATER=extruder TEMP={TEMP} WAIT={WAIT}
    {% else %}
        SET_HEATER HEATER="extruder{TOOL}" TEMP={TEMP} WAIT={WAIT}
    {% endif %}

[gcode_macro M104]
description: Set hotend temperature
rename_existing: M99104
gcode:
    {% set TEMP = params.S|float %}
    {% set TOOL = params.T|default(-1)|int %}
    _SET_HOTEND TEMP={TEMP} TOOL={TOOL} WAIT=0

[gcode_macro M109]
description: Wait for hotend temperature
rename_existing: M99109
gcode:
    {% set TEMP = params.S|float %}
    {% set TOOL = params.T|default(-1)|int %}
    _SET_HOTEND TEMP={TEMP} TOOL={TOOL} WAIT=1

[gcode_macro _SET_BED]
description: Set hotend temperature
gcode:
    {% set TEMP = params.TEMP|default(0)|int %}
    {% set WAIT = params.WAIT|default(0)|int %}

    SET_HEATER HEATER=heater_bed TEMP={TEMP} WAIT={WAIT}

[gcode_macro M140]
description: Set bed temperature
rename_existing: M99140
gcode:
    {% set TEMP = params.S|float %}
    _SET_BED TEMP={TEMP} WAIT=0

[gcode_macro M190]
description: Wait for bed temperature
rename_existing: M99190
gcode:
    {% set TEMP = params.S|int %}
    _SET_BED TEMP={TEMP} WAIT=1